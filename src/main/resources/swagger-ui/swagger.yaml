openapi: 3.0.3

info:
  title: API MS Comparecimento SUS
  description: API responsavel por disponibilizar indicadores de comparecimento e absenteismo
  version: 1.1.0

tags:
  - name: Pacientes
    description: Indicadores individuais de comparecimento
  - name: Relatorios
    description: Relatorios gerenciais e agregados

paths:

  /pacientes/indice-comparecimento:
    get:
      tags:
        - Pacientes
      summary: Consultar indice de comparecimento do paciente
      operationId: consultarIndiceComparecimentoPaciente
      parameters:
        - name: cns
          in: query
          required: true
          schema:
            type: string
            example: 89800112345678
      responses:
        '200':
          description: Indice de comparecimento retornado
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/IndiceComparecimentoResponse'
        '404':
          description: Paciente nao encontrado

  /relatorios/absenteismo:
    get:
      tags:
        - Relatorios
      summary: Consultar indicadores consolidados por periodo
      operationId: relatorioAbsenteismoPorPeriodo
      parameters:
        - name: dataInicio
          in: query
          required: true
          schema:
            type: string
            format: date
            example: 2026-01-01
        - name: dataFim
          in: query
          required: true
          schema:
            type: string
            format: date
            example: 2026-01-31
      responses:
        '200':
          description: Indicadores consolidados retornados
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RelatorioAbsenteismoResponse'
        '400':
          description: Periodo invalido

components:
  schemas:
    IndiceComparecimentoResponse:
      type: object
      properties:
        cns:
          type: string
          example: 89800112345678
        icc:
          type: number
          example: 72.5
        classificacao:
          type: string
          example: MEDIO_RISCO
        totalComparecimentos:
          type: integer
          example: 8
        totalAgendamentos:
          type: integer
          example: 8
        totalFaltas:
          type: integer
          example: 3
        totalCancelamentos:
          type: integer
          example: 3
        totalConfirmacoes:
          type: integer
          example: 5
        ultimaAtualizacao:
          type: string
          format: date-time
          example: 2026-01-20T14:35:00-03:00

    RelatorioAbsenteismoResponse:
      type: object
      properties:
        periodo:
          $ref: '#/components/schemas/PeriodoResponse'
        totalPessoas:
          type: integer
          example: 320
        iccMedio:
          type: number
          example: 67.4
        totalConsultas:
          type: integer
          example: 1200
        totalFaltas:
          type: integer
          example: 340
        taxaAbsenteismo:
          type: number
          example: 28.3
        dataGeracao:
          type: string
          format: date-time
          example: 2026-02-01T10:00:00-03:00

    PeriodoResponse:
      type: object
      properties:
        dataInicio:
          type: string
          format: date
          example: 2026-01-01
        dataFim:
          type: string
          format: date
          example: 2026-01-31

    EventoAgendamentoMessage:
      type: object
      description: Evento de agendamento publicado via mensageria
      properties:
        idAgendamento:
          type: integer
          format: int64
          example: 1
        cns:
          type: string
          example: 123456789012345
        statusConsulta:
          type: string
          example: AGENDADO
        statusNotificacao:
          type: string
          example: AGENDADO
        dataEvento:
          type: string
          format: date-time
          example: 2026-01-15T09:30:00-03:00

    EventoComparecimentoMessage:
      type: object
      description: Evento de agendamento publicado via mensageria
      properties:
        idAgendamento:
          type: integer
          format: int64
          example: 1
        cns:
          type: string
          example: 123456789012345
        sugestaoConduta:
          type: string
          example: MANTER_FLUXO_PADRAO
        iccScore:
          type: integer
          example: 92
        justificativa:
          type: string
          example: Paciente com ICC de 92%. Classificado como 'Confi√°vel'
